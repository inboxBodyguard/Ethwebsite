<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ðŸš¨ Incident Playbook Generator</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Source+Code+Pro:wght@300;400;600&display=swap');
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Source Code Pro', monospace;
      background: #000; color: #00ff41; overflow-x: hidden;
      position: relative; min-height: 100vh;
    }
    .matrix-bg { position: fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:1; opacity:0.15; }
    .matrix-column { position:absolute; top:-100px; font-size:14px; color:#00ff41; text-shadow:0 0 5px #00ff41; animation: matrix-fall linear infinite; }
    @keyframes matrix-fall { 0%{ transform:translateY(-100vh);} 100%{ transform:translateY(100vh);} }
    .container {
      position: relative; z-index: 10; max-width: 900px; margin: 20px auto;
      padding: 40px 20px; background: rgba(0,0,0,0.85); backdrop-filter: blur(10px);
      border: 1px solid rgba(0,255,65,0.3); border-radius: 15px;
      box-shadow: 0 0 30px rgba(0,255,65,0.2);
    }
    h1 {
      font-family:'Orbitron', monospace; font-weight:900; font-size:2.5rem;
      color:#ff0040; text-align:center; text-shadow:0 0 20px #ff0040,0 0 40px #ff0040;
      margin-bottom:40px; animation:pulse-red 2s infinite alternate;
    }
    @keyframes pulse-red { 0%{ text-shadow:0 0 20px #ff0040,0 0 40px #ff0040; } 100%{ text-shadow:0 0 30px #ff0040,0 0 60px #ff0040,0 0 80px #ff0040; } }
    .form-group { margin:25px 0; }
    label { display:block; font-family:'Orbitron'; font-weight:700; color:#00ff41; margin-bottom:10px; }
    select {
      width:100%; padding:15px; font-size:16px; background:rgba(0,20,0,0.8); color:#00ff41;
      border:2px solid #00ff41; border-radius:8px; outline:none;
    }
    .button-group { display:flex; gap:20px; justify-content:center; flex-wrap:wrap; margin:30px 0; }
    button {
      font-family:'Orbitron'; font-weight:700; padding:15px 30px; font-size:16px;
      background:linear-gradient(45deg, rgba(0,255,65,0.1), rgba(0,255,65,0.2));
      color:#00ff41; border:2px solid #00ff41; border-radius:8px; cursor:pointer;
    }
    #output { margin-top:40px; padding:30px; background:rgba(0,20,0,0.6); border:1px solid rgba(0,255,65,0.4); border-radius:10px; min-height:100px; }
    #output h2 { font-family:'Orbitron'; font-weight:700; color:#ff0040; font-size:1.8rem; margin-bottom:25px; text-align:center; }
    #output ol { padding-left:30px; line-height:2; }
    #output li { margin:15px 0; padding:15px; background:rgba(0,255,65,0.05); border-left:4px solid #00ff41; border-radius:5px; }
  </style>
</head>
<body>
  <div class="matrix-bg" id="matrixBg"></div>

  <div class="container">
    <h1>ðŸš¨ Incident Playbook Generator</h1>
    <div class="form-group">
      <label for="incident">[ SELECT INCIDENT TYPE ]</label>
      <select id="incident"></select>
    </div>
    <div class="button-group">
      <button onclick="generatePlaybook()">[ GENERATE PLAYBOOK ]</button>
      <button onclick="downloadPDF()">[ DOWNLOAD PDF ]</button>
    </div>
    <div id="output"></div>
  </div>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    // Matrix Rain Effect
    function createMatrixRain() {
      const matrixBg = document.getElementById('matrixBg');
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*(){}[]<>?/\\|`~+=_-';
      const numColumns = Math.floor(window.innerWidth / 20);
      for (let i = 0; i < numColumns; i++) {
        const column = document.createElement('div');
        column.className = 'matrix-column';
        column.style.left = `${i * 20}px`;
        column.style.animationDuration = `${Math.random() * 3 + 2}s`;
        column.style.animationDelay = `${Math.random() * 2}s`;
        let columnText = '';
        for (let j = 0; j < 20; j++) columnText += chars[Math.floor(Math.random() * chars.length)] + '<br>';
        column.innerHTML = columnText;
        matrixBg.appendChild(column);
      }
    }
    createMatrixRain();

    // Default playbooks (fallback if JSON fails)
    const defaultPlaybooks = {
      "Phishing Email": ["Disconnect affected device","Collect email headers","Verify malicious links"],
      "Ransomware Infection": ["Isolate infected systems","Do NOT pay ransom","Restore from backups"],
      "Data Breach": ["Isolate systems","Assess compromised data","Notify authorities"]
    };

    // Load playbooks.json
    function loadPlaybooks() {
      fetch('playbooks.json')
        .then(res => {
          if (!res.ok) throw new Error("HTTP " + res.status);
          return res.json();
        })
        .then(data => {
          window.playbooks = data;
          console.log("âœ… Loaded playbooks.json");
          populateDropdown(data);
        })
        .catch(err => {
          console.error("âš ï¸ Could not load playbooks.json, using defaults:", err);
          window.playbooks = defaultPlaybooks;
          populateDropdown(defaultPlaybooks);
        });
    }

    // Populate dropdown
    function populateDropdown(playbooks) {
      const dropdown = document.getElementById("incident");
      dropdown.innerHTML = "";
      Object.keys(playbooks).forEach(key => {
        const option = document.createElement("option");
        option.value = key;
        option.textContent = key;
        dropdown.appendChild(option);
      });
    }

    // Generate playbook
    function generatePlaybook() {
      const type = document.getElementById("incident").value;
      const steps = window.playbooks[type] || [];
      const output = document.getElementById("output");
      output.innerHTML = `<h2>${type} Response Steps</h2>`;
      let list = "<ol>";
      steps.forEach(step => list += `<li>${step}</li>`);
      list += "</ol>";
      output.innerHTML += list;
    }

    // Download as PDF
    function downloadPDF() {
      const outputContent = document.getElementById("output").innerText;
      if (!outputContent.trim()) {
        alert("Please generate a playbook first!");
        return;
      }
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(16);
      doc.text("Incident Playbook", 20, 20);
      doc.setFontSize(12);
      const lines = doc.splitTextToSize(outputContent, 170);
      doc.text(lines, 20, 40);
      doc.save("incident-playbook.pdf");
    }

    // Init
    loadPlaybooks();
  </script>
</body>
</html>