<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Signup | EZM Cyber - Your Digital Security Partner</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { background: linear-gradient(135deg,#0a0a0a,#16213e); color:#e0e6ed; font-family:'Inter',sans-serif; min-height:100vh; display:flex; align-items:center; justify-content:center; }
.login-container { width:100%; max-width:400px; margin:2rem; background:rgba(22,33,62,0.8); backdrop-filter:blur(15px); border-radius:16px; padding:2.5rem; border:1px solid rgba(0,255,204,0.2); box-shadow:0 20px 40px rgba(0,0,0,0.4); position:relative; }
.brand-logo { text-align:center; margin-bottom:2rem; }
.brand-logo h1 { font-size:2rem; font-weight:700; color:#00ffcc; margin-bottom:0.5rem; text-shadow:0 0 10px rgba(0,255,204,0.3);}
.brand-logo p { font-size:0.9rem; color:#b8c6db; margin:0; }
.form-group { margin-bottom:1.5rem; }
.form-label { display:block; color:#e0e6ed; margin-bottom:0.5rem; font-weight:500; font-size:0.9rem; }
.form-control { width:100%; padding:12px 16px; background: rgba(16,21,30,0.8); border:1px solid rgba(0,255,204,0.3); border-radius:8px; color:#fff; font-size:1rem; }
.form-control:focus { outline:none; border-color:#00ffcc; background:rgba(16,21,30,0.9); box-shadow:0 0 0 3px rgba(0,255,204,0.1);}
.btn-primary { width:100%; padding:14px; background:linear-gradient(135deg,#00ffcc,#00ccaa); color:#000; border:none; border-radius:8px; font-weight:600; cursor:pointer; margin-bottom:1rem;}
.btn-primary:hover { transform:translateY(-2px); box-shadow:0 8px 25px rgba(0,255,204,0.3);}
.error-message,.success-message { padding:12px; border-radius:8px; font-size:0.9rem; margin-bottom:1rem; display:none; }
.error-message { background:rgba(255,59,48,0.1); border:1px solid rgba(255,59,48,0.3); color:#ff6b6b; }
.success-message { background:rgba(52,199,89,0.1); border:1px solid rgba(52,199,89,0.3); color:#34c759; }
#verify-btn { display:none; margin-top:0.5rem; }
.google-btn { width:100%; padding:12px; background:#fff; color:#333; border:1px solid #dadce0; border-radius:8px; font-size:1rem; font-weight:500; cursor:pointer; display:flex; justify-content:center; gap:10px; margin-bottom:1rem; }
.google-btn:hover { background:#f8f9fa; }
</style>
</head>
<body>
<div class="login-container">
  <div class="brand-logo">
    <h1>EZM Cyber</h1>
    <p>Secure Signup</p>
  </div>

  <div id="error-message" class="error-message"></div>
  <div id="success-message" class="success-message"></div>

  <button id="google-signin-btn" class="google-btn">
    Continue with Google
  </button>

  <div class="divider"><span>or</span></div>

  <form id="signup-form">
    <div class="form-group">
      <label for="email" class="form-label">Email Address</label>
      <input type="email" id="email" class="form-control" placeholder="Enter your email" required>
    </div>
    <div class="form-group">
      <label for="password" class="form-label">Password</label>
      <input type="password" id="password" class="form-control" placeholder="Enter your password" required>
    </div>
    <div id="recaptcha-container" style="display:none; margin-top:1rem;"></div>
    <button type="button" id="verify-btn" class="btn-primary">Verify & Continue</button>
  </form>
</div>

<script src="https://accounts.google.com/gsi/client" async defer></script>
<script src="https://www.google.com/recaptcha/api.js?onload=onRecaptchaLoad&render=explicit" async defer></script>

<script>
const RECAPTCHA_SITE_KEY='6Lf8YtMrAAAAAB5bqKoDDQwtLcq3pLKlL_JniYaG';
let recaptchaWidgetId = null;
let recaptchaReady = false;

function onRecaptchaLoad() { recaptchaReady=true; renderRecaptcha(); }
function renderRecaptcha() {
  if(!recaptchaReady) return;
  if(recaptchaWidgetId===null){
    recaptchaWidgetId=grecaptcha.render('recaptcha-container',{sitekey:RECAPTCHA_SITE_KEY,theme:'light'});
  }
  document.getElementById('recaptcha-container').style.display='block';
  document.getElementById('verify-btn').style.display='block';
}
function verifyRecaptchaThenSignup(callback){
  if(typeof grecaptcha==='undefined'){alert('reCAPTCHA not loaded'); return;}
  const token=grecaptcha.getResponse(recaptchaWidgetId);
  if(!token){alert('Please complete the reCAPTCHA'); return;}
  callback(token);
}

document.getElementById('verify-btn').addEventListener('click',()=>{
  verifyRecaptchaThenSignup(async (token)=>{
    const email=document.getElementById('email').value;
    const password=document.getElementById('password').value;
    try{
      const res=await fetch('/verify',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:`g-recaptcha-response=${encodeURIComponent(token)}`});
      if(res.ok){
        sessionStorage.setItem('user',JSON.stringify({email,loginMethod:'email'}));
        showSuccess('Successfully signed up!');
        setTimeout(()=>window.location.href='home.html',1500);
      }else alert('Verification failed');
    }catch(e){console.error(e);alert('Server error');}
  });
});

function showError(msg){ const e=document.getElementById('error-message'); e.textContent=msg; e.style.display='block'; setTimeout(()=>e.style.display='none',5000);}
function showSuccess(msg){ const s=document.getElementById('success-message'); s.textContent=msg; s.style.display='block';}

const GOOGLE_CLIENT_ID='328276925081-72l44j7i0tln1ldk1kkmtelh1smjal4v.apps.googleusercontent.com';
document.getElementById('google-signin-btn').addEventListener('click',()=>{
  const btn=document.getElementById('google-signin-btn');
  btn.disabled=true; btn.textContent='Signing in...';
  google.accounts.id.initialize({client_id:GOOGLE_CLIENT_ID,callback:handleCredentialResponse});
  google.accounts.id.prompt();
});
function handleCredentialResponse(response){
  const userInfo=JSON.parse(atob(response.credential.split('.')[1]));
  sessionStorage.setItem('user',JSON.stringify({name:userInfo.name,email:userInfo.email,loginMethod:'google'}));
  showSuccess('Signed in with Google!');
  setTimeout(()=>window.location.href='home.html',1500);
}
</script>
</body>
</html>