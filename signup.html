<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login | EZM Cyber - Your Digital Security Partner</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
      color: #e0e6ed;
      font-family: 'Inter', sans-serif;
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .login-container {
      width: 100%;
      max-width: 400px;
      margin: 2rem;
      background: rgba(22, 33, 62, 0.8);
      backdrop-filter: blur(15px);
      border-radius: 16px;
      padding: 2.5rem;
      border: 1px solid rgba(0, 255, 204, 0.2);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
      position: relative;
      overflow: hidden;
    }

    .login-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, #00ffcc, transparent);
    }

    .brand-logo { text-align: center; margin-bottom: 2rem; }
    .brand-logo h1 {
      font-size: 2rem;
      font-weight: 700;
      color: #00ffcc;
      margin-bottom: 0.5rem;
      text-shadow: 0 0 10px rgba(0, 255, 204, 0.3);
    }
    .brand-logo p { color: #b8c6db; font-size: 0.9rem; margin: 0; }

    .form-group { margin-bottom: 1.5rem; }
    .form-label { display: block; color: #e0e6ed; font-weight: 500; margin-bottom: 0.5rem; font-size: 0.9rem; }
    .form-control {
      width: 100%;
      padding: 12px 16px;
      background: rgba(16, 21, 30, 0.8);
      border: 1px solid rgba(0, 255, 204, 0.3);
      border-radius: 8px;
      color: #fff;
      font-size: 1rem;
      transition: all 0.3s ease;
    }
    .form-control:focus {
      outline: none;
      border-color: #00ffcc;
      background: rgba(16, 21, 30, 0.9);
      box-shadow: 0 0 0 3px rgba(0, 255, 204, 0.1);
    }
    .form-control::placeholder { color: #8a94a6; }

    .btn-primary {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #00ffcc, #00ccaa);
      color: #000;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 1rem;
    }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0, 255, 204, 0.3); }
    .btn-primary:active { transform: translateY(0); }

    .divider {
      display: flex;
      align-items: center;
      margin: 1.5rem 0;
      color: #8a94a6;
      font-size: 0.9rem;
    }
    .divider::before, .divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: rgba(138, 148, 166, 0.3);
    }
    .divider span { padding: 0 1rem; }

    .google-btn {
      width: 100%;
      padding: 12px 16px;
      background: #ffffff;
      color: #333;
      border: 1px solid #dadce0;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-bottom: 1.5rem;
      text-decoration: none;
    }
    .google-btn:hover { background: #f8f9fa; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15); transform: translateY(-1px); }
    .google-btn:active { transform: translateY(0); box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1); }
    .google-icon { width: 20px; height: 20px; background-image: url('data:image/svg+xml;base64,...'); background-size: contain; background-repeat: no-repeat; }

    .forgot-password { text-align: center; margin-bottom: 1rem; }
    .forgot-password a { color: #00ffcc; text-decoration: none; font-size: 0.9rem; transition: color 0.3s ease; }
    .forgot-password a:hover { color: #00e6b8; text-decoration: underline; }

    .signup-link { text-align: center; color: #b8c6db; font-size: 0.9rem; }
    .signup-link a { color: #00ffcc; text-decoration: none; font-weight: 500; transition: color 0.3s ease; }
    .signup-link a:hover { color: #00e6b8; text-decoration: underline; }

    .back-home { position: absolute; top: 1rem; left: 1rem; z-index: 10; }
    .back-home a { color: #00ffcc; text-decoration: none; font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem; transition: all 0.3s ease; }
    .back-home a:hover { color: #00e6b8; }

    .error-message, .success-message {
      padding: 12px;
      border-radius: 8px;
      font-size: 0.9rem;
      margin-bottom: 1rem;
      display: none;
    }
    .error-message { background: rgba(255,59,48,0.1); border: 1px solid rgba(255,59,48,0.3); color: #ff6b6b; }
    .success-message { background: rgba(52,199,89,0.1); border: 1px solid rgba(52,199,89,0.3); color: #34c759; }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(0,0,0,0.3);
      border-radius: 50%;
      border-top-color: #000;
      animation: spin 1s ease-in-out infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    @media (max-width: 480px) {
      .login-container { margin: 1rem; padding: 2rem; }
      .brand-logo h1 { font-size: 1.75rem; }
    }
  </style>
</head>
<body>
  <div class="back-home">
    <a href="index.html">‚Üê Back to Home</a>
  </div>

  <div class="login-container">
    <div class="brand-logo">
      <h1>EZM Cyber</h1>
      <p>Secure Login</p>
    </div>

    <div id="error-message" class="error-message"></div>
    <div id="success-message" class="success-message"></div>

    <!-- Google Sign-In -->
    <div id="g_id_onload"
         data-client_id="328276925081-72l44j7i0tln1ldk1kkmtelh1smjal4v.apps.googleusercontent.com"
         data-context="signin"
         data-ux_mode="popup"
         data-callback="handleCredentialResponse"
         data-auto_prompt="false">
    </div>

    <button id="google-signin-btn" class="google-btn" onclick="handleGoogleSignIn()">
      <div class="google-icon"></div>
      <span id="google-btn-text">Continue with Google</span>
    </button>

    <div class="divider"><span>or</span></div>

    <!-- Traditional login -->
    <form id="login-form">
      <div class="form-group">
        <label for="email" class="form-label">Email Address</label>
        <input type="email" id="email" name="email" class="form-control" placeholder="Enter your email" required>
      </div>
      <div class="form-group">
        <label for="password" class="form-label">Password</label>
        <input type="password" id="password" name="password" class="form-control" placeholder="Enter your password" required>
      </div>
      <button type="submit" class="btn-primary" id="login-btn">
        <span id="login-btn-text">Sign In</span>
      </button>
    </form>

    <div class="forgot-password">
      <a href="#" onclick="showForgotPassword()">Forgot your password?</a>
    </div>

    <div class="signup-link">
      Don't have an account? <a href="signup.html">Sign up here</a>
    </div>
  </div>

  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

  <script>
    const GOOGLE_CLIENT_ID = '328276925081-72l44j7i0tln1ldk1kkmtelh1smjal4v.apps.googleusercontent.com';

    document.addEventListener('DOMContentLoaded', function() {
      const onloadDiv = document.getElementById('g_id_onload');
      onloadDiv.setAttribute('data-client_id', GOOGLE_CLIENT_ID);

      const user = sessionStorage.getItem('user');
      if (user) window.location.href = 'home.html';
    });

    function handleCredentialResponse(response) {
      const userInfo = parseJwt(response.credential);
      sessionStorage.setItem('user', JSON.stringify({
        name: userInfo.name,
        email: userInfo.email,
        picture: userInfo.picture,
        loginMethod: 'google'
      }));
      showSuccess('Successfully signed in with Google!');
      setTimeout(() => { window.location.href = 'home.html'; }, 1500);
    }

    function handleGoogleSignIn() {
      const btn = document.getElementById('google-signin-btn');
      const btnText = document.getElementById('google-btn-text');
      btnText.innerHTML = '<div class="loading"></div> Signing in...';
      btn.disabled = true;

      google.accounts.id.initialize({ client_id: GOOGLE_CLIENT_ID, callback: handleCredentialResponse });
      google.accounts.id.prompt((notification) => {
        if (notification.isNotDisplayed() || notification.isSkippedMoment()) {
          btnText.textContent = 'Continue with Google';
          btn.disabled = false;
          google.accounts.id.renderButton(document.getElementById("google-signin-btn"), { theme: "outline", size: "large", width: "100%" });
        }
      });
    }

    function parseJwt(token) {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      return JSON.parse(decodeURIComponent(atob(base64).split('').map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join('')));
    }

    document.getElementById('login-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const loginBtn = document.getElementById('login-btn');
      const loginBtnText = document.getElementById('login-btn-text');

      loginBtnText.innerHTML = '<div class="loading"></div> Signing in...';
      loginBtn.disabled = true;

      setTimeout(() => {
        if (email && password) {
          sessionStorage.setItem('user', JSON.stringify({ email: email, loginMethod: 'email' }));
          showSuccess('Successfully signed in!');
          setTimeout(() => { window.location.href = 'home.html'; }, 1500);
        } else {
          showError('Please fill in all fields');
          loginBtnText.textContent = 'Sign In';
          loginBtn.disabled = false;
        }
      }, 1000);
    });

    function showError(message) {
      const errorDiv = document.getElementById('error-message');
      errorDiv.textContent = message;
      errorDiv.style.display = 'block';
      document.getElementById('success-message').style.display = 'none';
      setTimeout(() => { errorDiv.style.display = 'none'; }, 5000);
    }

    function showSuccess(message) {
      const successDiv = document.getElementById('success-message');
      successDiv.textContent = message;
      successDiv.style.display = 'block';
      document.getElementById('error-message').style.display = 'none';
    }

    function showForgotPassword() {
      const email = prompt('Enter your email address to reset your password:');
      if (email && email.includes('@')) showSuccess('Password reset instructions sent to your email!');
      else if (email) showError('Please enter a valid email address');
    }
  </script>
  <!-- Email and Password Inputs (assuming you have these already) -->
<input type="email" id="email" placeholder="Email" required>
<input type="password" id="password" placeholder="Password" required>

<!-- Hidden reCAPTCHA container -->
<div id="recaptcha-container" style="display:none; margin-top:1rem;"></div>

<!-- Verify button -->
<button id="verify-btn" class="btn-primary" style="display:none; margin-top:0.5rem;">
  Verify & Continue
</button>

<script>
  const RECAPTCHA_SITE_KEY ='6Lf8YtMrAAAAAB5bqKoDDQwtLcq3pLKlL_JniYaG'; // Replace with your site key
  let recaptchaWidgetId = null;
  let recaptchaReady = false;

  // reCAPTCHA onload callback
  function onRecaptchaLoad() {
    recaptchaReady = true;
    renderRecaptcha();
  }

  // Render reCAPTCHA
  function renderRecaptcha() {
    if (!recaptchaReady) return;
    if (recaptchaWidgetId === null) {
      recaptchaWidgetId = grecaptcha.render('recaptcha-container', {
        sitekey: RECAPTCHA_SITE_KEY,
        theme: 'light'
      });
    }
    document.getElementById('recaptcha-container').style.display = 'block';
    document.getElementById('verify-btn').style.display = 'block';
  }

  // Verify token and proceed (example: mock login; integrate with backend below)
  function verifyRecaptchaThenLogin(callback) {
    if (typeof grecaptcha === 'undefined') {
      alert('reCAPTCHA not loaded');
      return;
    }
    const token = grecaptcha.getResponse(recaptchaWidgetId);
    if (!token) {
      alert('Please complete the reCAPTCHA');
      return;
    }
    callback(token);
  }

  // Button click to verify and continue
  document.getElementById('verify-btn').addEventListener('click', () => {
    verifyRecaptchaThenLogin(async (token) => {
      // Integrate with backend: POST token to /verify
      try {
        const response = await fetch('/verify', {  // Change to your backend URL if hosted separately
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: `g-recaptcha-response=${encodeURIComponent(token)}`
        });
        if (response.ok) {
          const email = document.getElementById('email').value;
          const password = document.getElementById('password').value;
          sessionStorage.setItem('user', JSON.stringify({ email, loginMethod: 'email' }));
          showSuccess('Successfully signed in!');  // Assume showSuccess is defined elsewhere
          setTimeout(() => { window.location.href = 'home.html'; }, 1500);
        } else {
          alert('Verification failed');
        }
      } catch (err) {
        console.error('Error:', err);
        alert('Server error');
      }
    });
  });
</script>

<!-- Load reCAPTCHA API -->
<script src="https://www.google.com/recaptcha/api.js?onload=onRecaptchaLoad&render=explicit" async defer></script>
</body>
</html>