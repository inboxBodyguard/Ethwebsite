<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Suspicious Link Checker | EZM Cyber</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet" />
  <style>
    body {
      background-color: #0a0a0a;
      color: #e0ffe0;
      font-family: 'Orbitron', sans-serif;
      padding: 30px;
    }
    h1 { color: #00ffcc; }
    input[type="url"] {
      width: 100%;
      padding: 12px;
      background-color: #111;
      border: 1px solid #00ffcc;
      color: #fff;
      margin: 10px 0;
    }
    button {
      padding: 10px 20px;
      background-color: #00ffcc;
      border: none;
      color: #000;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover { background-color: #00ccaa; }
    button:disabled {
      background-color: #666;
      cursor: not-allowed;
    }
    #result { margin-top: 20px; font-weight: bold; }
    .loading { color: #00ffcc; }
    .scan-details {
      margin-top: 10px;
      padding: 10px;
      background-color: #111;
      border-left: 3px solid #00ffcc;
    }
    .detection-ratio {
      font-size: 1.2em;
      font-weight: bold;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #00ffcc;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #111;
    }
  </style>
</head>
<body>

 <!-- Suspicious Link Checker Section -->
<section id="link-checker" style="margin-top:30px;">
  <h2>Suspicious Link Checker</h2>
  <form id="linkForm">
    <input type="url" id="urlInput" placeholder="Paste URL here..." required style="width:100%; padding:10px; margin:10px 0;"/>
    <button type="submit" id="checkBtn" style="padding:10px 20px; background:#00ffcc; border:none; cursor:pointer; font-weight:bold;">Check</button>
  </form>
  <div id="result" style="margin-top:20px; font-weight:bold;"></div>
  <h3>Scan History</h3>
  <table id="historyTable" style="width:100%; border-collapse:collapse;">
    <thead>
      <tr>
        <th>URL</th>
        <th>Status</th>
        <th>Detections</th>
        <th>Scan Date</th>
        <th>Report</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<script>
const form = document.getElementById('linkForm');
const result = document.getElementById('result');
const checkBtn = document.getElementById('checkBtn');
const historyTbody = document.querySelector('#historyTable tbody');

function getUrlId(url){
  return btoa(url).replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'');
}

function displayResults(attributes, url) {
  const stats = attributes.last_analysis_stats || {};
  const malicious = stats.malicious || 0;
  const total = Object.values(stats).reduce((a,b)=>a+b,0);

  result.innerHTML = `<div>${malicious} / ${total} detections</div>`;

  // Add to history
  const row = document.createElement('tr');
  const status = malicious>0 ? 'Suspicious':'Safe';
  const date = new Date().toLocaleString();
  const reportLink = `https://www.virustotal.com/gui/url/${getUrlId(url)}`;
  row.innerHTML = `<td>${url}</td><td>${status}</td><td>${malicious}/${total}</td><td>${date}</td><td><a href="${reportLink}" target="_blank" style="color:#00ffcc;">View Report</a></td>`;
  historyTbody.appendChild(row);
}

form.addEventListener('submit', async e=>{
  e.preventDefault();
  const url = document.getElementById('urlInput').value.trim();
  if(!url) return;

  result.innerHTML = 'Checking...';
  checkBtn.disabled = true;

  try {
    const res = await fetch('https://cb0fcf53-04f5-430b-bfbd-f54ffce1e063-00-dvfiqwm9c8cu.picard.replit.dev/api/virustotal', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ url })
    });
    const data = await res.json();

    // Check for errors in response
    if (!res.ok || data.error) {
      result.innerHTML = `<div style="color:red;">Error: ${data.error || 'Request failed'}</div>`;
      return;
    }

    displayResults(data, url);
  } catch(err) {
    result.innerHTML = `<div style="color:red;">Error: ${err.message}</div>`;
  } finally {
    checkBtn.disabled = false;
  }
});

</script>
</body>
</html>
