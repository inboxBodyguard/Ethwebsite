<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Suspicious Link Checker | EZM Cyber</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet" />
  <style>
    body {
      background-color: #0a0a0a;
      color: #e0ffe0;
      font-family: 'Orbitron', sans-serif;
      padding: 30px;
    }
    h1 { color: #00ffcc; }
    input[type="url"] {
      width: 100%;
      padding: 12px;
      background-color: #111;
      border: 1px solid #00ffcc;
      color: #fff;
      margin: 10px 0;
    }
    button {
      padding: 10px 20px;
      background-color: #00ffcc;
      border: none;
      color: #000;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover { background-color: #00ccaa; }
    button:disabled {
      background-color: #666;
      cursor: not-allowed;
    }
    #result { margin-top: 20px; font-weight: bold; }
    .loading { color: #00ffcc; }
    .scan-details {
      margin-top: 10px;
      padding: 10px;
      background-color: #111;
      border-left: 3px solid #00ffcc;
    }
    .detection-ratio {
      font-size: 1.2em;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h1>Suspicious Link Checker</h1>
  <p>Enter a link below to verify its safety:</p>

  <form id="linkForm">
    <input type="url" id="urlInput" placeholder="Paste suspicious URL here..." required />
    <button type="submit" id="checkBtn">Check</button>
  </form>

  <div id="result"></div>

  <script>
    const form = document.getElementById('linkForm');
    const result = document.getElementById('result');
    const checkBtn = document.getElementById('checkBtn');
    const API_KEY = 'aae37bf314798b0edf335b4818114280a268aaf936bd7d4b0e695b81870f08a8'; // REGENERATE THIS!

    // Initial keyword filtering
    const suspiciousKeywords = ["free-gift", "login-now", "verify-account", "bit.ly", "tinyurl", "short.ly"];

    async function scanWithVirusTotal(url) {
      try {
        // Step 1: Submit URL for scanning
        const scanResponse = await fetch('https://www.virustotal.com/vtapi/v2/url/scan', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'apikey': API_KEY
          },
          body: new URLSearchParams({ url: url })
        });

        if (!scanResponse.ok) {
          throw new Error(`HTTP ${scanResponse.status}: ${scanResponse.statusText}`);
        }

        const scanData = await scanResponse.json();
        const resourceId = scanData.resource;

        // Step 2: Poll for scan results (wait up to 30 seconds)
        result.innerHTML = '<div class="loading">üîÑ Scanning with VirusTotal... Please wait.</div>';
        checkBtn.disabled = true;
        checkBtn.textContent = 'Scanning...';

        let attempts = 0;
        const maxAttempts = 15; // 15 seconds * 2 = 30 seconds total

        while (attempts < maxAttempts) {
          await new Promise(resolve => setTimeout(resolve, 2000)); // Wait 2 seconds
          
          const reportResponse = await fetch(`https://www.virustotal.com/vtapi/v2/url/report`, {
            method: 'GET',
            headers: {
              'apikey': API_KEY
            },
            body: new URLSearchParams({ resource: resourceId })
          });

          if (!reportResponse.ok) {
            throw new Error(`HTTP ${reportResponse.status}: ${reportResponse.statusText}`);
          }

          const reportData = await reportResponse.json();
          
          if (reportData.response_code === 1) {
            // Scan completed
            displayResults(reportData, url);
            return;
          } else if (reportData.response_code === -2) {
            // Still queued
            attempts++;
            if (attempts >= maxAttempts) {
              showTimeoutResult(url);
            }
          } else {
            throw new Error('Unknown response code');
          }
        }
      } catch (error) {
        console.error('VirusTotal API Error:', error);
        result.innerHTML = `
          <div style="color: orange;">
            ‚ö†Ô∏è Error connecting to VirusTotal. 
            <br><small>Opening manual scan...</small>
          </div>
        `;
        setTimeout(() => {
          const encodedUrl = encodeURIComponent(url);
          window.open(`https://www.virustotal.com/gui/home/url?url=${encodedUrl}`, "_blank");
        }, 1500);
      } finally {
        checkBtn.disabled = false;
        checkBtn.textContent = 'Check';
      }
    }

    function displayResults(data, originalUrl) {
      const total = data.total || 0;
      const positives = data.positives || 0;
      const permalink = data.permalink || '';
      const scanDate = data.scan_date || '';
      const urlDetails = data.url || originalUrl;

      const detectionRate = total > 0 ? Math.round((positives / total) * 100) : 0;
      let status, color, message;

      if (positives === 0) {
        status = "‚úÖ CLEAN";
        color = "lightgreen";
        message = "No security vendors detected threats.";
      } else if (positives <= 2) {
        status = "‚ö†Ô∏è LOW RISK";
        color = "yellow";
        message = `${positives}/${total} security vendors flagged potential issues.`;
      } else {
        status = "üö® MALICIOUS";
        color = "red";
        message = `${positives}/${total} security vendors detected malware/phishing.`;
      }

      result.innerHTML = `
        <div style="color: ${color};">
          <strong>${status}</strong><br>
          ${message}
        </div>
        <div class="scan-details">
          <strong>URL:</strong> <a href="${urlDetails}" target="_blank" style="color: #00ffcc;">${urlDetails}</a><br>
          <strong>Detections:</strong> <span class="detection-ratio" style="color: ${color};">${positives}/${total}</span><br>
          <strong>Scanned:</strong> ${new Date(scanDate).toLocaleString()}<br>
          <a href="${permalink}" target="_blank" style="color: #00ffcc; text-decoration: underline;">
            üîç View Full VirusTotal Report
          </a>
        </div>
      `;
    }

    function showTimeoutResult(url) {
      result.innerHTML = `
        <div style="color: orange;">
          ‚è±Ô∏è Scan still processing (took longer than expected)
          <br><small>Opening VirusTotal for manual review...</small>
        </div>
      `;
      setTimeout(() => {
        const encodedUrl = encodeURIComponent(url);
        window.open(`https://www.virustotal.com/gui/home/url?url=${encodedUrl}`, "_blank");
      }, 1500);
    }

    form.addEventListener('submit', function(event) {
      event.preventDefault();
      const url = document.getElementById('urlInput').value.trim();
      result.innerHTML = '';

      // Basic validation
      if (!url.startsWith("https://") && !url.startsWith("http://")) {
        result.innerHTML = '<div style="color: yellow;">‚ö†Ô∏è Please include http:// or https://</div>';
        return;
      }

      // Keyword filtering (preliminary check)
      const isSuspicious = suspiciousKeywords.some(keyword => url.includes(keyword));
      
      if (isSuspicious) {
        result.innerHTML = `
          <div style="color: red;">
            üö® Warning: This link contains suspicious keywords and may be part of a phishing scheme.
            <br><small>Still scanning with VirusTotal for confirmation...</small>
          </div>
        `;
        // Continue with API scan anyway
        setTimeout(() => scanWithVirusTotal(url), 500);
      } else {
        scanWithVirusTotal(url);
      }
    });
  </script>

</body>
</html>