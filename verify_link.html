<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Suspicious Link Checker | EZM Cyber</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet" />
  <style>
    body {
      background-color: #0a0a0a;
      color: #e0ffe0;
      font-family: 'Orbitron', sans-serif;
      padding: 30px;
    }
    h1 { color: #00ffcc; }
    input[type="url"] {
      width: 100%;
      padding: 12px;
      background-color: #111;
      border: 1px solid #00ffcc;
      color: #fff;
      margin: 10px 0;
    }
    button {
      padding: 10px 20px;
      background-color: #00ffcc;
      border: none;
      color: #000;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover { background-color: #00ccaa; }
    button:disabled {
      background-color: #666;
      cursor: not-allowed;
    }
    #result { margin-top: 20px; font-weight: bold; }
    .loading { color: #00ffcc; }
    .scan-details {
      margin-top: 10px;
      padding: 10px;
      background-color: #111;
      border-left: 3px solid #00ffcc;
    }
    .detection-ratio {
      font-size: 1.2em;
      font-weight: bold;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #00ffcc;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #111;
    }
  </style>
</head>
<body>

  <h1>Suspicious Link Checker</h1>
  <p>Enter a link below to verify its safety:</p>

  <form id="linkForm">
    <input type="url" id="urlInput" placeholder="Paste suspicious URL here..." required />
    <button type="submit" id="checkBtn">Check</button>
  </form>

  <div id="result"></div>

  <h2>Scan History</h2>
  <table id="historyTable">
    <thead>
      <tr>
        <th>URL</th>
        <th>Status</th>
        <th>Detections</th>
        <th>Scan Date</th>
        <th>Report</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const form = document.getElementById('linkForm');
    const result = document.getElementById('result');
    const checkBtn = document.getElementById('checkBtn');
    const historyTbody = document.querySelector('#historyTable tbody');
    const API_KEY = 'aae37bf314798b0edf335b4818114280a268aaf936bd7d4b0e695b81870f08a8'; // REGENERATE THIS!

    // Initial keyword filtering
    const suspiciousKeywords = ["free-gift", "login-now", "verify-account", "bit.ly", "tinyurl", "short.ly"];

    async function getUrlId(url) {
      return btoa(url).replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
    }

    async function scanWithVirusTotal(url) {
      try {
        const urlId = await getUrlId(url);

        // Step 0: Try to get existing URL report
        let reportResponse = await fetch(`https://www.virustotal.com/api/v3/urls/${urlId}`, {
          headers: { 'x-apikey': API_KEY }
        });

        let reportData;
        if (reportResponse.ok) {
          reportData = await reportResponse.json();
          displayResults(reportData.data.attributes, url, urlId);
          return;
        } else if (reportResponse.status !== 404) {
          throw new Error(`HTTP ${reportResponse.status}: ${reportResponse.statusText}`);
        }

        // Step 1: Submit URL for scanning if not found
        const scanResponse = await fetch('https://www.virustotal.com/api/v3/urls', {
          method: 'POST',
          headers: { 'x-apikey': API_KEY },
          body: new URLSearchParams({ url: url })
        });

        if (!scanResponse.ok) {
          throw new Error(`HTTP ${scanResponse.status}: ${scanResponse.statusText}`);
        }

        const scanData = await scanResponse.json();
        const analysisId = scanData.data.id;

        // Step 2: Poll for scan results (wait up to 30 seconds)
        result.innerHTML = '<div class="loading">ðŸ”„ Scanning with VirusTotal... Please wait.</div>';
        checkBtn.disabled = true;
        checkBtn.textContent = 'Scanning...';

        let attempts = 0;
        const maxAttempts = 15; // 15 * 2s = 30s

        while (attempts < maxAttempts) {
          await new Promise(resolve => setTimeout(resolve, 2000)); // Wait 2 seconds

          reportResponse = await fetch(`https://www.virustotal.com/api/v3
           <script>