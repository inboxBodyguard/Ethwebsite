<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Link Safety Checker</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{
--bg-1:#06060a; --bg-2:#0b0710;
--accent:#00ffcc; --muted:#9fb6b0;
--clean:#16a34a; --suspicious:#f59e0b; --phish:#ef4444; --unrated:#6b7280;
--bubble-user:#00ffcc25; --bubble-bot:#071218;
}
body{
background:linear-gradient(135deg,var(--bg-1),var(--bg-2));
color:#e6fff8;font-family:"Orbitron",system-ui,sans-serif;
height:100vh;display:flex;flex-direction:column;
}
#chat-container{
flex:1;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:16px;scroll-behavior:smooth;
}
.msg{
max-width:85%;padding:12px 16px;border-radius:16px;line-height:1.5;word-wrap:break-word;
font-size:0.95rem;display:inline-block;position:relative;animation:pop 0.25s ease-out;
}
@keyframes pop{0%{transform:scale(0.95);opacity:0}100%{transform:scale(1);opacity:1}}
.user{align-self:flex-end;background:var(--bubble-user);border:1px solid rgba(0,255,204,0.3);color:#e6fff8}
.bot{align-self:flex-start;background:var(--bubble-bot);border:1px solid rgba(0,255,204,0.1)}
.bot strong{color:var(--accent)}
#input-bar{display:flex;padding:12px;border-top:1px solid rgba(0,255,204,0.1);background:rgba(255,255,255,0.03)}
#url-input{flex:1;padding:12px;border:none;background:rgba(0,0,0,0.3);color:#e6fff8;border-radius:8px;font-size:1rem}
#send-btn{margin-left:8px;padding:12px 18px;background:var(--accent);color:#001517;font-weight:700;border:none;border-radius:8px;cursor:pointer;transition:0.2s}
#send-btn:hover{filter:brightness(1.2)}
.status-safe{color:var(--clean)}
.status-susp{color:var(--suspicious)}
.status-bad{color:var(--phish)}
.vendor-grid{margin-top:10px;display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:8px}
.vendor-card{padding:8px;border-radius:8px;background:rgba(255,255,255,0.05);border:1px solid rgba(0,255,204,0.06);font-size:0.8rem;text-align:center}
.typing{display:inline-block;font-style:italic;opacity:0.8}
.dot{animation:blink 1.2s infinite}
@keyframes blink{0%,20%{opacity:0}50%{opacity:1}100%{opacity:0}}
footer{text-align:center;padding:10px;color:var(--muted);font-size:0.8rem}
#main-result{
transition:all 0.3s ease;
}
#main-result:hover{
transform:scale(1.02);
box-shadow:0 0 40px rgba(0,255,204,0.25);
}
@media (max-width:600px){
#chat-container{padding:12px;gap:12px}
#url-input{font-size:0.9rem}
#send-btn{padding:10px 14px;font-size:0.9rem}
.vendor-card{font-size:0.75rem}
}
</style>
</head>
<body>

<div id="chat-container">
  <div class="msg bot"><strong>Instructions:</strong> Drop any link and I‚Äôll scan it with top security vendors to see if it‚Äôs safe üîç</div>
</div>

<div id="input-bar">
  <input id="url-input" type="text" placeholder="Paste a link to check..." autocomplete="off">
  <button id="send-btn">Send</button>
</div>

<footer>Secure ‚Ä¢ Protect ‚Ä¢ Respond</footer>

<script>
const BACKEND_API = 'https://ethwebsite-ulau.onrender.com/api/virustotal';
const chat = document.getElementById('chat-container');
const input = document.getElementById('url-input');
const sendBtn = document.getElementById('send-btn');

function addMessage(text, sender='bot') {
  const div=document.createElement('div');
  div.className=`msg ${sender}`;
  div.innerHTML=text;
  chat.appendChild(div);
  chat.scrollTop=chat.scrollHeight;
  return div;
}

function verdictClass(v){
  if(v==='phish'||v==='malicious') return 'status-bad';
  if(v==='suspicious') return 'status-susp';
  return 'status-safe';
}

function addTyping(){
  return addMessage(`<span class="typing">Scanning<span class="dot">.</span><span class="dot">.</span><span class="dot">.</span></span>`,'bot');
}

async function analyzeLink(url){
  const typingDiv=addTyping();
  try{
    const resp=await fetch(BACKEND_API,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({url})
    });
    if(!resp.ok) throw new Error(`Error ${resp.status}`);
    const data=await resp.json();
    if(!data.last_analysis_results) throw new Error('Invalid response');

    const vendors=Object.entries(data.last_analysis_results).map(([name,info])=>{
      const cat=info?.category?.toLowerCase()||'unrated';
      let v='unrated';
      if(cat==='malicious'||cat==='phishing') v='phish';
      else if(cat==='suspicious') v='suspicious';
      else if(cat==='harmless'||cat==='clean') v='clean';
      return {name,verdict:v};
    });

    const stats={mal:0,susp:0,clean:0};
    vendors.forEach(v=>{
      if(v.verdict==='phish') stats.mal++;
      else if(v.verdict==='suspicious') stats.susp++;
      else if(v.verdict==='clean') stats.clean++;
    });

    const total=vendors.length;
    const threatCount=stats.mal+stats.susp;
    let status='safe',label='CLEAN';
    if(stats.mal>0){status='bad';label='MALICIOUS';}
    else if(stats.susp>0){status='susp';label='SUSPICIOUS';}
    if(stats.susp>0 && stats.mal===0){label=`Mostly Clean (${stats.susp} flagged)`;}

    let html=`<strong>Status:</strong> <span class="${'status-'+status}">${label}</span><br>
      <small>Detections: ${threatCount}/${total}</small>`;
    html+=`<div class="vendor-grid">`+
      vendors.slice(0,90).map(v=>`
        <div class="vendor-card">${v.name}<br><span class="${verdictClass(v.verdict)}">${v.verdict.toUpperCase()}</span></div>
      `).join('')+`</div>`;

    typingDiv.remove();

    // ----- pinned dashboard-style result -----
    let resultBox=document.getElementById('main-result');
    if(!resultBox){
      resultBox=document.createElement('div');
      resultBox.id='main-result';
      resultBox.style.padding='20px';
      resultBox.style.margin='20px 0';
      resultBox.style.borderRadius='12px';
      resultBox.style.background='rgba(0,255,204,0.08)';
      resultBox.style.border='1px solid rgba(0,255,204,0.2)';
      resultBox.style.fontSize='1rem';
      resultBox.style.textAlign='left';
      resultBox.style.boxShadow='0 0 25px rgba(0,255,204,0.1)';
      resultBox.style.animation='pop 0.4s ease-out';
      chat.prepend(resultBox);
    }
    resultBox.innerHTML=`<strong>üîç Latest Scan Result</strong><br><br>${html}`;

    // ----- save recent history (session only) -----
    const saved=JSON.parse(sessionStorage.getItem('ezm_history')||'[]');
    saved.unshift({url,verdict:status, detections:threatCount, total});
    if(saved.length>50) saved.pop();
    sessionStorage.setItem('ezm_history',JSON.stringify(saved));

  }catch(e){
    console.error(e);
    typingDiv.remove();
    addMessage(`‚ö†Ô∏è Could not complete the scan right now.`,'bot');
  }
}

sendBtn.onclick=()=>{
  const val=input.value.trim();
  if(!val) return;
  addMessage(val,'user');
  input.value='';
  let normalized=val;
  if(!/^https?:\/\//i.test(val)) normalized='http://'+val;
  try{
    new URL(normalized);
    analyzeLink(normalized);
  }catch{
    addMessage('Invalid URL format.','bot');
  }
};

input.addEventListener('keypress',e=>{
  if(e.key==='Enter') sendBtn.click();
});
</script>

</body>
</html>